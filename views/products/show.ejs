<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<%= product.name %>
<%= product.category %>
<%= product.clean ? "clean" : "not clean" %>

<%= Math.floor(product.reviews.reduce((total,review) =>  total + review.rating, 0) / product.reviews.length) %>


<h2>Reviews</h2>

<h3>What was your experience with this product?</h3>
<% if (user) { %>

    <form action="/products/<%= product._id %>/reviews" method="POST" id="review-form">
      <label>
        Name: 
        <input type="text" name="name" autocomplete="off">
      </label><br>
      <label>
        Review: 
        <input type="text" name="review" autocomplete="off">
      </label><br>
      <label>
        Rating: 
        <input type="number" name="rating" autocomplete="off">
      </label><br>
      <input name="reviewer" value="<%= user.profile._id %>" hidden >
      <button type="submit">Add Review</button>
    </form>
  <% } %>


<h2>All the reviews</h2>
<ul>
    <% product.reviews.forEach(review => { %>
    <li> <%= review.name %> 
        <%= review.review %> 
        <%= review.rating %>/5 
    </li> 
        <section>
           
            <% if (review.reviewer.equals(user?.profile._id)) { %>
                <p>
                    <form action="/products/<%= product._id %>/reviews/<%= review._id %>/edit"> 
                      <button type="submit">Edit this Review</button>
                      <form>
                </p>
                <p>
                    <form action="/products/<%= product._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST">
                        <button type="submit">Delete this review</button>
                    </form>
                </p>
            <% } %>
        </section>
       
    <% }) %>
</ul>



<%- include('../partials/footer') %>